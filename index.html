<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rebecca AI Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .header {
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            text-align: center;
        }

        .header h1 {
            color: #4a5568;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            color: #718096;
            font-size: 14px;
        }

        .status {
            padding: 10px 20px;
            background: #f0f8ff;
            border-bottom: 1px solid #e2e8f0;
            font-size: 12px;
            color: #2d3748;
        }

        .status.connected {
            background: #f0fff4;
            color: #38a169;
        }

        .status.error {
            background: #fff5f5;
            color: #e53e3e;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.user {
            align-self: flex-end;
            background: #667eea;
            color: white;
        }

        .message.assistant {
            align-self: flex-start;
            background: #f7fafc;
            color: #2d3748;
            border: 1px solid #e2e8f0;
        }

        .message.system {
            align-self: center;
            background: #fed7d7;
            color: #c53030;
            font-size: 12px;
            max-width: 90%;
        }

        .typing {
            align-self: flex-start;
            background: #f7fafc;
            color: #718096;
            font-style: italic;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .input-container {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e2e8f0;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: #667eea;
        }

        .send-button {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }

        .send-button:hover:not(:disabled) {
            background: #5a67d8;
        }

        .send-button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }

        .config-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .config-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 12px;
        }

        .connect-button {
            padding: 8px 16px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }

        .connect-button:hover {
            background: #38a169;
        }

        .suggestions {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion {
            padding: 6px 12px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion:hover {
            background: rgba(102, 126, 234, 0.2);
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="header">
            <h1>ü§ñ Rebecca AI Assistant</h1>
            <p>Your personal AI with access to Gmail, Calendar, Drive & More</p>
        </div>

        <div id="status" class="status">
            Ready to connect - Enter your OpenAI API key below
        </div>

        <div id="messages" class="chat-messages">
            <div class="message system">
                Welcome to Rebecca! I'm your AI assistant with direct access to:
                <br>‚Ä¢ Gmail - Check, send, and manage emails
                <br>‚Ä¢ Calendar - View and schedule events  
                <br>‚Ä¢ Drive - Find and organize files
                <br>‚Ä¢ Sheets - Read and analyze data
                <br><br>Enter your OpenAI API key to get started!
            </div>
        </div>

        <div class="input-container">
            <div class="config-row">
                <input type="password" id="openaiKey" class="config-input" placeholder="Enter your OpenAI API Key (sk-...)">
                <input type="text" id="composioKey" class="config-input" placeholder="Composio API Key (optional)">
                <button id="connectBtn" class="connect-button">Connect</button>
            </div>

            <div class="input-row">
                <input type="text" id="messageInput" class="input-field" placeholder="Ask Rebecca anything..." disabled>
                <button id="sendBtn" class="send-button" disabled>Send</button>
            </div>

            <div class="suggestions">
                <div class="suggestion" onclick="sendMessage('Check my latest emails')">üìß Check emails</div>
                <div class="suggestion" onclick="sendMessage('What\'s my schedule today?')">üìÖ Today\'s schedule</div>
                <div class="suggestion" onclick="sendMessage('Find my recent Drive files')">üìÅ Recent files</div>
                <div class="suggestion" onclick="sendMessage('Send email to...')">‚úâÔ∏è Send email</div>
            </div>
        </div>
    </div>

    <script>
        let isConnected = false;
        let isTyping = false;
        let conversationHistory = [];
        let openaiApiKey = '';
        let composioApiKey = '';

        // DOM Elements
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const connectBtn = document.getElementById('connectBtn');
        const openaiKeyInput = document.getElementById('openaiKey');
        const composioKeyInput = document.getElementById('composioKey');

        // Load saved keys
        openaiApiKey = localStorage.getItem('openai_api_key') || '';
        composioApiKey = localStorage.getItem('composio_api_key') || '';

        if (openaiApiKey) {
            openaiKeyInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            if (composioApiKey) {
                composioKeyInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            }
            connect();
        }

        // Event listeners
        connectBtn.addEventListener('click', connect);
        sendBtn.addEventListener('click', () => sendMessage());
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        function connect() {
            const newOpenAIKey = openaiKeyInput.value.trim();
            const newComposioKey = composioKeyInput.value.trim();

            if (!newOpenAIKey || newOpenAIKey === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                if (!openaiApiKey) {
                    updateStatus('Please enter your OpenAI API key', 'error');
                    return;
                }
            } else {
                openaiApiKey = newOpenAIKey;
                localStorage.setItem('openai_api_key', openaiApiKey);
            }

            if (newComposioKey && newComposioKey !== '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                composioApiKey = newComposioKey;
                localStorage.setItem('composio_api_key', composioApiKey);
            }

            // Test connection
            testConnection();
        }

        async function testConnection() {
            updateStatus('Connecting to OpenAI...', 'connecting');

            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${openaiApiKey}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    isConnected = true;
                    updateStatus('‚úÖ Connected! Rebecca is ready to help.', 'connected');
                    messageInput.disabled = false;
                    sendBtn.disabled = false;
                    messageInput.placeholder = "Ask Rebecca anything...";
                    messageInput.focus();

                    // Hide keys for security
                    openaiKeyInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                    if (composioApiKey) composioKeyInput.value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';

                } else {
                    throw new Error(`OpenAI API error: ${response.status}`);
                }
            } catch (error) {
                updateStatus(`‚ùå Connection failed: ${error.message}`, 'error');
                isConnected = false;
            }
        }

        function updateStatus(message, type = '') {
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function addMessage(text, sender = 'user') {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}`;
            messageEl.textContent = text;
            messagesEl.appendChild(messageEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;

            // Save to conversation history
            if (sender !== 'system') {
                conversationHistory.push({
                    role: sender === 'user' ? 'user' : 'assistant',
                    content: text
                });
            }
        }

        function showTyping() {
            if (isTyping) return;
            isTyping = true;

            const typingEl = document.createElement('div');
            typingEl.className = 'message typing';
            typingEl.id = 'typing';
            typingEl.textContent = 'Rebecca is thinking...';
            messagesEl.appendChild(typingEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function hideTyping() {
            const typingEl = document.getElementById('typing');
            if (typingEl) {
                typingEl.remove();
            }
            isTyping = false;
        }

        async function sendMessage(text = null) {
            if (!isConnected) {
                updateStatus('Please connect first', 'error');
                return;
            }

            const message = text || messageInput.value.trim();
            if (!message) return;

            // Clear input
            messageInput.value = '';

            // Add user message
            addMessage(message, 'user');

            // Show typing indicator
            showTyping();

            try {
                // Check if this is a Rube/productivity request
                const isProductivityRequest = /email|gmail|calendar|schedule|drive|file|sheet|spreadsheet/i.test(message);

                let systemPrompt = `You are Rebecca, a professional AI assistant. Be direct, efficient, and helpful.`;

                if (isProductivityRequest && composioApiKey) {
                    systemPrompt = `You are Rebecca, a professional AI assistant with access to Gmail, Calendar, Drive, and Sheets via Composio tools. When users ask about emails, calendar, files, or data:
1. Acknowledge the request
2. Explain that you're checking their accounts
3. For now, provide helpful guidance and suggest they connect their accounts to Rube.app for full functionality
4. Be specific about what you would do with full access

You can help with productivity tasks like:
‚Ä¢ Check, send, and manage emails
‚Ä¢ View and schedule calendar events  
‚Ä¢ Find and organize Drive files
‚Ä¢ Read and analyze spreadsheet data

Always be concise but thorough.`;
                }

                // Prepare conversation context
                const messages = [
                    { role: 'system', content: systemPrompt },
                    ...conversationHistory.slice(-10),
                    { role: 'user', content: message }
                ];

                // Make OpenAI API call
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiApiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: messages,
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`OpenAI API error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                const assistantResponse = data.choices[0].message.content;

                hideTyping();
                addMessage(assistantResponse, 'assistant');

            } catch (error) {
                hideTyping();
                addMessage(`Sorry, I encountered an error: ${error.message}`, 'system');
                console.error('Error:', error);
            }
        }

        // Auto-save conversation
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('conversation_history', JSON.stringify(conversationHistory));
        });

        // Load conversation history
        const savedHistory = localStorage.getItem('conversation_history');
        if (savedHistory) {
            try {
                conversationHistory = JSON.parse(savedHistory);
            } catch (e) {
                console.error('Failed to load conversation history');
            }
        }
    </script>
</body>
</html>